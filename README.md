# pwn | ctf_harry_potter

## Информация

Задание представляет собой уязвимую систему с несколькими векторами атаки:

1. **LFI уязвимость** в Flask веб-приложении на порту 1080
2. **Уязвимая версия sudo** (1.9.16p2) с известным CVE

**Общий ход решения:**
- Участник находит веб-сервер на порту 1080 с уязвимостью LFI
- Через LFI читает `.bash_history` пользователя davy и находит подсказку о файле `password.txt`
- Читает `password.txt` и получает пароль для SSH
- Подключается по SSH и находит информацию о уязвимости sudo
- Эксплуатирует CVE в sudo для получения root-доступа
- Получает флаг

## Деплой

### Требования
- Docker
- Открытые порты: 1022 (SSH), 1080 (HTTP)

### Сборка и запуск из исходников
```bash
cd deploy
docker build -t ctf_harry_potter .
docker run -d -p 1022:1022 -p 1080:1080 --name ctf_harry_potter ctf_harry_potter
```

### Запуск из готового образа
```bash
cker pull ghcr.io/savo4ka/ctf_harry_potter:v1.0
docker run -d -p 1022:1022 -p 1080:1080 --name ctf_harry_potter ghcr.io/savo4ka/ctf_harry_potter:v1.0
```

### Проверка работоспособности
```bash
# Проверка веб-сервера
curl http://localhost:1080/

# Проверка SSH
ssh -p 1022 joey@localhost
# Пароль: Lf8vw7XJcR02E0bQlogp
```

### Остановка
```bash
docker stop ctf_harry_potter
docker rm ctf_harry_potter
```

## Выдать участникам

**Что выдать:**
- IP-адрес и порты (1022 для SSH, 1080 для HTTP)
- Никаких файлов не требуется

**Формат:**
```
Сервер: <IP>:1080 (HTTP)
SSH: <IP>:1022
```

**Цель:**
Получить root доступ и прочитать хеш пароля пользователя johny в `/etc/shadow`

## Описание для площадки

**Название:** Заметки администратора

**Описание:**

Вы нашли веб-сервер одной небольшой компании. Администратор утверждает, что всё защищено и никаких уязвимостей нет. Но что-то подсказывает, что он не прав...

Может быть, стоит поискать какие-нибудь интересные файлы на сервере?

Подключение:
- HTTP: `http://<IP>:1080`
- SSH: `<IP>:1022`

## Флаг

`FECTF{golden_snitch}`

---

## Пользователи

| Пользователь | Пароль | Примечание |
|--------------|--------|------------|
| joey | Lf8vw7XJcR02E0bQlogp | Обычный пользователь, имеет notes.txt |
| davy | Je8pw3dFmWRUqeFm3i3l | Владелец веб-сервера, пароль в password.txt |
| johny | FECTF{golden_snitch} | Пароль закодирован в base64 в /etc/shadow |

## Уязвимости

1. **LFI в веб-приложении** - отсутствует проверка на path traversal
2. **sudo 1.9.16p2** - CVE-2025-32463 (heap-based buffer overflow)
3. **Информация в .bash_history** - подсказка о password.txt
